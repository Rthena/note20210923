## 1、给哪些内存数据做快照？

1、Redis 在内存中的全量数据。

2、Redis 提供了两个命令来生成 RDB 文件，分别是 save 和 bgsave
. save: 在主线程中执行，会导致阻塞；
. bgsave: 在主线程中执行，专门用于写入 RDB 文件，避免了主线程的阻塞，这也是 Redis RDB 文件生成的默认配置。

## 2、快照时数据能修改吗？

为了快照而暂停写操作，肯定是不能接受的。Redis 会借助操作系统提供的写时复制技术（Copy-On-Write，COW）,在执行快照的同时，正常处理写操作。

![image-20211027102125246](/Users/Rthena/Desktop/redis极客时间/05丨内存快照：宕机后，Redis如何实现快速恢复？/写时复制机制保证快照期间数据可修改.png)



## 3、可以每秒做一次快照吗？

1、缺点，如果频繁执行全量快照，也会带来两名方面的开销。一方面，频繁将全量数据写入磁盘，会给磁盘带来很大压力。另一方面，fork 会阻塞主线程，而且主线程的内容越大，阻塞时间越长久。

2、Redis 4.0 中提出一个混合使用 AOF 日志和内存快照

## 4、小结

![image-20211027104626172](/Users/Rthena/Desktop/redis极客时间/05丨内存快照：宕机后，Redis如何实现快速恢复？/小结.png)